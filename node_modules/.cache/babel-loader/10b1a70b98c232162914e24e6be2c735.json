{"ast":null,"code":"import HomeRecommendView from './childComps/HomeRecommendView';\nimport HomeFeature from './childComps/HomeFeature';\nimport NavBar from 'components/common/navbar/NavBar';\nimport Scroll from 'components/common/scroll/Scroll';\nimport TabControl from 'components/content/tabControl/TabControl';\nimport Carousel from 'components/content/Carousel/Carousel';\nimport GoodsList from 'components/content/goods/GoodsList';\nimport BackTop from 'components/content/backTop/BackTop';\nimport { getHomeMultidata, getHomeGoods } from '@/network/home';\nimport { debounce } from '@/common/utils/property.js';\nexport default {\n  name: 'Home',\n\n  data() {\n    return {\n      banner: [],\n      recommends: [],\n      // 默认显示params.pop\n      currentPage: 'pop',\n      goods: {\n        'pop': {\n          page: 0,\n          list: []\n        },\n        'new': {\n          page: 0,\n          list: []\n        },\n        'sell': {\n          page: 0,\n          list: []\n        }\n      },\n      isBackTop: false,\n      tabOffsetTop: 0,\n      isTabFixed: false\n    };\n  },\n\n  // 组件创建完成发送网络请求\n  created() {\n    // 请求多个数据\n    this.getHomeMultidata(); // 请求商品数据\n\n    this.getHomeGoods(\"pop\");\n    this.getHomeGoods(\"new\");\n    this.getHomeGoods(\"sell\");\n  },\n\n  mounted() {\n    const refresh = debounce(this.$refs.scroll.refresh, 500); // 监听item中图片加载完成，重新计算高度\n    // this.$bus.$on('itemImageLoad', () => {\n    //   this.$refs.scroll.bscroll && this.$refs.scroll.bscroll.refresh()\n    // })\n\n    this.$bus.$on('itemImageLoad', () => refresh()); // 获取tabControl的offsettop\n    // 所有组件都有一个属性$el，用于获取组件中的元素\n\n    this.$bus.$on('carouselImgLoad', () => {\n      console.log('轮播图加载完成'); // console.log(this.$refs.tabControl.$el.offsetTop)\n\n      this.tabOffsetTop = this.$refs.tabControl.$el.offsetTop;\n    });\n  },\n\n  methods: {\n    /**\n     * 网络请求相关方法\n     */\n    getHomeMultidata() {\n      getHomeMultidata().then(res => {\n        const {\n          data\n        } = res.data;\n        this.banner = data.banner.list;\n        this.recommends = data.recommend.list;\n      });\n    },\n\n    getHomeGoods(type) {\n      // 请求之后page+1\n      const page = this.goods[type].page + 1;\n      getHomeGoods(type, page).then(res => {\n        const {\n          data\n        } = res.data;\n        this.goods[type].list.push(...data.list);\n        this.goods[type].page + 1; // 执行scroll插件的一个方法，上拉加载更多  scroll组件中的bscroll的实例(插件)的方法\n\n        this.$refs.scroll && this.$refs.scroll.finishPullUp();\n      });\n    },\n\n    /**\n     * 事件监听相关\n     */\n    // 防抖\n    // debounce (func, delay) {\n    //   let timer = null\n    //   return (...args) => {\n    //     if (timer) clearTimeout(timer)\n    //     timer = setTimeout(() => {\n    //       func.apply(this, args)\n    //     }, delay)\n    //   }\n    // },\n    // 根据点击tabClick方法的index显示不同的路由\n    tabClick(index) {\n      // console.log(index)\n      switch (index) {\n        case 0:\n          this.currentPage = 'pop';\n          break;\n\n        case 1:\n          this.currentPage = 'new';\n          break;\n\n        case 2:\n          this.currentPage = 'sell';\n          break;\n      }\n    },\n\n    // 组件事件监听事件， .navtive监听组件跟元素的原生事件  @click.navtive=\"backTop\"\n    backTop() {\n      // 拿到scroll组件,获取滚动插件实例,scrollTo是滚动插件的api\n      this.$refs.scroll && this.$refs.scroll.scrollTo(0, 0, 1000);\n    },\n\n    // 显示隐藏返回顶部组件\n    handleScroll(position) {\n      // 上拉到一定高度隐藏\n      this.isBackTop = position.y < -600;\n      console.log(this.tabOffsetTop);\n      this.isTabFixed = position.y > this.tabOffsetTop;\n    },\n\n    // 上拉加载更多\n    loadMore() {\n      // 继续发送网络请求\n      this.getHomeGoods(this.currentPage); // 图片加载完成，然后重新计算可滚动的区域,才能继续出发上拉事件\n\n      this.$refs.scroll && this.$refs.scroll.refresh();\n    }\n\n  },\n  computed: {\n    showGoods() {\n      return this.goods[this.currentPage].list;\n    }\n\n  },\n  components: {\n    HomeRecommendView,\n    HomeFeature,\n    NavBar,\n    Scroll,\n    TabControl,\n    Carousel,\n    GoodsList,\n    BackTop\n  }\n};","map":{"version":3,"mappings":"AAoCA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA,SACAA,gBADA,EAEAC,YAFA,QAGA,gBAHA;AAKA;AACA;EACAC,YADA;;EAEAC;IACA;MACAC,UADA;MAEAC,cAFA;MAGA;MACAC,kBAJA;MAKAC;QACA;UAAAC;UAAAC;QAAA,CADA;QAEA;UAAAD;UAAAC;QAAA,CAFA;QAGA;UAAAD;UAAAC;QAAA;MAHA,CALA;MAUAC,gBAVA;MAWAC,eAXA;MAYAC;IAZA;EAcA,CAjBA;;EAkBA;EACAC;IACA;IACA,wBAFA,CAGA;;IACA;IACA;IACA;EACA,CA1BA;;EA2BAC;IACA,yDADA,CAEA;IACA;IACA;IACA;;IACA,gDANA,CAQA;IACA;;IACA;MACAC,uBADA,CAEA;;MACA;IACA,CAJA;EAKA,CA1CA;;EA2CAC;IACA;AACA;AACA;IACAhB;MACAA;QACA;UAAAG;QAAA;QACA;QACA;MACA,CAJA;IAKA,CAVA;;IAWAF;MACA;MACA;MACAA;QACA;UAAAE;QAAA;QACA;QACA,0BAHA,CAKA;;QACA;MACA,CAPA;IAQA,CAtBA;;IAuBA;AACA;AACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAc;MACA;MACA;QACA;UACA;UACA;;QACA;UACA;UACA;;QACA;UACA;UACA;MATA;IAWA,CAlDA;;IAmDA;IACAC;MACA;MACA;IACA,CAvDA;;IAwDA;IACAC;MACA;MACA;MACAJ;MACA;IACA,CA9DA;;IA+DA;IACAK;MACA;MACA,oCAFA,CAGA;;MACA;IACA;;EArEA,CA3CA;EAmHAC;IACAC;MACA;IACA;;EAHA,CAnHA;EAwHAC;IACAC,iBADA;IAEAC,WAFA;IAGAC,MAHA;IAIAC,MAJA;IAKAC,UALA;IAMAC,QANA;IAOAC,SAPA;IAQAC;EARA;AAxHA","names":["getHomeMultidata","getHomeGoods","name","data","banner","recommends","currentPage","goods","page","list","isBackTop","tabOffsetTop","isTabFixed","created","mounted","console","methods","tabClick","backTop","handleScroll","loadMore","computed","showGoods","components","HomeRecommendView","HomeFeature","NavBar","Scroll","TabControl","Carousel","GoodsList","BackTop"],"sourceRoot":"src/views/home","sources":["Home.vue"],"sourcesContent":["<template>\n  <div id=\"home\">\n    <!-- 导航栏 -->\n    <nav-bar class=\"home-nav\"><div slot=\"center\">购物街</div></nav-bar>\n    <tab-control\n      :titles=\"['流行', '新款', '精选']\"\n      @tabClick=\"tabClick\"\n      ref=\"tabControl\"\n      class=\"tab-control\"\n      v-show=\"isTabFixed\"\n    ></tab-control>\n    <!-- 滚动插件容器 -->\n    <scroll\n      class=\"content\"\n      ref=\"scroll\"\n      :probeType=\"3\"\n      @scroll=\"handleScroll\"\n      :pull-up-load=\"true\"\n      @pullingup=\"loadMore\"\n    >\n      <!-- 走马灯 -->\n      <carousel :banners=\"banner\"></carousel>\n      <home-recommend-view :recommends=\"recommends\"></home-recommend-view>\n      <home-feature></home-feature>\n      <tab-control\n        :titles=\"['流行', '新款', '精选']\"\n        @tabClick=\"tabClick\"\n        ref=\"tabControl\"\n      ></tab-control>\n      <goods-list :goods=\"showGoods\"></goods-list>\n    </scroll>\n    <back-top @click.native=\"backTop\" v-show=\"isBackTop\"></back-top>\n  </div>\n</template>\n\n<script>\nimport HomeRecommendView from './childComps/HomeRecommendView'\nimport HomeFeature from './childComps/HomeFeature'\n\nimport NavBar from 'components/common/navbar/NavBar'\nimport Scroll from 'components/common/scroll/Scroll'\nimport TabControl from 'components/content/tabControl/TabControl'\nimport Carousel from 'components/content/Carousel/Carousel'\nimport GoodsList from 'components/content/goods/GoodsList'\nimport BackTop from 'components/content/backTop/BackTop'\n\nimport {\n  getHomeMultidata,\n  getHomeGoods\n} from '@/network/home'\n\nimport { debounce } from '@/common/utils/property.js'\nexport default {\n  name: 'Home',\n  data () {\n    return {\n      banner: [],\n      recommends: [],\n      // 默认显示params.pop\n      currentPage: 'pop',\n      goods: {\n        'pop': { page: 0, list: [] },\n        'new': { page: 0, list: [] },\n        'sell': { page: 0, list: [] }\n      },\n      isBackTop: false,\n      tabOffsetTop: 0,\n      isTabFixed: false\n    }\n  },\n  // 组件创建完成发送网络请求\n  created () {\n    // 请求多个数据\n    this.getHomeMultidata()\n    // 请求商品数据\n    this.getHomeGoods(\"pop\")\n    this.getHomeGoods(\"new\")\n    this.getHomeGoods(\"sell\")\n  },\n  mounted () {\n    const refresh = debounce(this.$refs.scroll.refresh, 500)\n    // 监听item中图片加载完成，重新计算高度\n    // this.$bus.$on('itemImageLoad', () => {\n    //   this.$refs.scroll.bscroll && this.$refs.scroll.bscroll.refresh()\n    // })\n    this.$bus.$on('itemImageLoad', () => refresh())\n\n    // 获取tabControl的offsettop\n    // 所有组件都有一个属性$el，用于获取组件中的元素\n    this.$bus.$on('carouselImgLoad', () => {\n      console.log('轮播图加载完成')\n      // console.log(this.$refs.tabControl.$el.offsetTop)\n      this.tabOffsetTop = this.$refs.tabControl.$el.offsetTop\n    })\n  },\n  methods: {\n    /**\n     * 网络请求相关方法\n     */\n    getHomeMultidata () {\n      getHomeMultidata().then(res => {\n        const { data } = res.data\n        this.banner = data.banner.list\n        this.recommends = data.recommend.list\n      })\n    },\n    getHomeGoods (type) {\n      // 请求之后page+1\n      const page = this.goods[type].page + 1\n      getHomeGoods(type, page).then(res => {\n        const { data } = res.data\n        this.goods[type].list.push(...data.list)\n        this.goods[type].page + 1\n\n        // 执行scroll插件的一个方法，上拉加载更多  scroll组件中的bscroll的实例(插件)的方法\n        this.$refs.scroll && this.$refs.scroll.finishPullUp()\n      })\n    },\n    /**\n     * 事件监听相关\n     */\n    // 防抖\n    // debounce (func, delay) {\n    //   let timer = null\n    //   return (...args) => {\n    //     if (timer) clearTimeout(timer)\n    //     timer = setTimeout(() => {\n    //       func.apply(this, args)\n    //     }, delay)\n    //   }\n    // },\n    // 根据点击tabClick方法的index显示不同的路由\n    tabClick (index) {\n      // console.log(index)\n      switch (index) {\n        case 0:\n          this.currentPage = 'pop'\n          break\n        case 1:\n          this.currentPage = 'new'\n          break\n        case 2:\n          this.currentPage = 'sell'\n          break\n      }\n    },\n    // 组件事件监听事件， .navtive监听组件跟元素的原生事件  @click.navtive=\"backTop\"\n    backTop () {\n      // 拿到scroll组件,获取滚动插件实例,scrollTo是滚动插件的api\n      this.$refs.scroll && this.$refs.scroll.scrollTo(0, 0, 1000)\n    },\n    // 显示隐藏返回顶部组件\n    handleScroll (position) {\n      // 上拉到一定高度隐藏\n      this.isBackTop = position.y < -600\n      console.log(this.tabOffsetTop)\n      this.isTabFixed = (position.y > this.tabOffsetTop)\n    },\n    // 上拉加载更多\n    loadMore () {\n      // 继续发送网络请求\n      this.getHomeGoods(this.currentPage)\n      // 图片加载完成，然后重新计算可滚动的区域,才能继续出发上拉事件\n      this.$refs.scroll && this.$refs.scroll.refresh()\n    }\n  },\n\n  computed: {\n    showGoods () {\n      return this.goods[this.currentPage].list\n    }\n  },\n  components: {\n    HomeRecommendView,\n    HomeFeature,\n    NavBar,\n    Scroll,\n    TabControl,\n    Carousel,\n    GoodsList,\n    BackTop\n  }\n}\n</script>\n\n<style scoped>\n#home {\n  height: 100vh;\n  position: relative;\n  /* padding-top: 44px; */\n}\n.home-nav {\n  background-color: var(--color-tint);\n  color: white;\n  /* \n    解决原生滚动问题，导航跟随滚动的问题\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  z-index: 999; */\n}\n.content {\n  position: absolute;\n  overflow: hidden;\n  top: 44px;\n  bottom: 49px;\n  left: 0;\n  right: 0;\n}\n/* 设置滚动的窗口高度 */\n/* .content {\n  height: calc(100% - 93px);\n  margin-top: 44px;\n  overflow: hidden;\n} */\n.showBackTop {\n  display: none;\n}\n.tab-control {\n  position: relative;\n  z-index: 10;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}